# 📋 הוראות לתיוג טווחי שורות עם AI

## שלב 1: יצירת תבנית התיוג

```bash
cd movie/scripts
python 01_tag_pages_with_ai.py
```

זה יוצר את הקובץ: `movie/output/scripts/pages_for_ai_tagging.json`

**מה הקובץ מכיל:**
- כל העמודים משני הספרים (~276 עמודים)
- כל עמוד כולל: `full_text`, `lines` (שורות ממוספרות), `chapter`, `page_number`
- השורות ממוספרות מ-1 ואילך

---

## שלב 2: שליחה ל-AI לתיוג

**✅ AI יכול לקבל את כל העמודים בבת אחת!**

הקובץ `pages_for_ai_tagging.json` מכיל את כל העמודים משני הספרים (~276 עמודים).
AI יכול לטפל בכולם בבת אחת.

**אם הקובץ גדול מדי:** ראה [AI_TAGGING_BATCHES.md](AI_TAGGING_BATCHES.md) - איך לעבוד בחלקים

### הוראות ל-ChatGPT/Claude/Gemini:

```
קח את הקובץ JSON הזה שמכיל עמודים משני ספרים על החיים במטולה בשנים 1900-1921.

המטרה שלך: תייג טווחי שורות (line ranges) בתוך כל עמוד.

לכל עמוד, תן לי רשימה של תיוגים, כאשר כל תיוג מתייחס לטווח שורות ספציפי.

פורמט הפלט:
{
  "line_tags": [
    {
      "line_start": <מספר שורה התחלה>,
      "line_end": <מספר שורה סוף>,
      "year": <מספר או null> - השנה (1900-1921),
      "month": <מחרוזת או null> - החודש (אם ניתן לזהות),
      "location": <מחרוזת או null> - המיקום הגיאוגרפי הראשי,
      "locations": [<רשימה>] - כל המיקומים המוזכרים בטווח השורות הזה,
      "characters": [<רשימה>] - הדמויות המוזכרות,
      "confidence": <"high"/"medium"/"low"> - רמת ביטחון בתיוג
    },
    ...
  ]
}

הנחיות חשובות:

1. **טווחי שורות:**
   - תייג טווחי שורות (לא כל שורה בנפרד, אלא קבוצות שורות עם אותו הקשר)
   - כל טווח צריך להיות רציף (line_start עד line_end)
   - טווחים יכולים להיות שורה אחת (line_start == line_end) או כמה שורות
   - ודא שכל השורות הלא-ריקות בעמוד מכוסות

2. **year** (מספר או null):
   - השנה המרכזית שבה מתרחשים האירועים בטווח השורות הזה (1900-1921)
   - אם יש תאריך מפורש, השתמש בו
   - אם אין תאריך מפורש, נסה להעריך לפי הקשר (פרקים, אירועים היסטוריים)
   - אם לא ניתן לזהות, תן null

3. **month** (מחרוזת או null):
   - החודש שבו מתרחשים האירועים (אם ניתן לזהות)
   - דוגמאות: "ינואר", "פברואר", "מרץ", "ניסן", "אייר", "תשרי", וכו'
   - אם לא ניתן לזהות, תן null

4. **location** (מחרוזת או null):
   - המיקום הגיאוגרפי הראשי שבו מתרחשים האירועים בטווח השורות הזה
   - דוגמאות: "metula", "jaffa", "beer_tuvia", "russia", "tel_hai", "nahalal", "kfar_giladi", "rosh_pina"
   - השתמש בשמות באנגלית (כמו ב-locations.json)
   - אם לא ניתן לזהות, תן null

5. **locations** (רשימה):
   - רשימה של כל המיקומים הגיאוגרפיים המוזכרים בטווח השורות הזה
   - גם אם לא המיקום המרכזי
   - אם אין מיקומים מוזכרים, תן רשימה ריקה []

6. **characters** (רשימה):
   - רשימה של כל הדמויות המוזכרות בטווח השורות הזה
   - דוגמאות: ["yehuda", "yosef", "moriah", "ruchama", "emmanuel", "tirza", "vazrach"]
   - אם אין דמויות מוזכרות, תן רשימה ריקה []

7. **confidence** (מחרוזת):
   - "high" - יש תאריך/מיקום מפורש בטקסט
   - "medium" - ניתן להעריך מהקשר (פרק, אירועים)
   - "low" - לא בטוח, אבל ניסיתי

חשוב מאוד:
- תייג את טווחי השורות בתוך כל עמוד בנפרד
- השתמש בהבנת הקשר כדי לזהות תאריכים ומיקומים גם אם הם לא מפורשים
- אם יש תאריך בפרק הקודם או בשורות הקודמות, זה יכול לעזור
- אם יש אירוע היסטורי מוזכר (כמו "מלחמת העולם הראשונה"), השתמש בו
- שמור על דיוק - אל תמציא תאריכים אם אתה לא בטוח
- ודא שכל השורות הלא-ריקות בעמוד מכוסות על ידי טווחים

דוגמה:
אם יש עמוד עם 10 שורות, ואתה מזהה:
- שורות 1-3: מדברות על 1904, יפו
- שורות 4-7: מדברות על 1905, מטולה
- שורות 8-10: מדברות על 1906, מטולה

תתייג 3 טווחים:
- line_start: 1, line_end: 3, year: 1904, location: "jaffa"
- line_start: 4, line_end: 7, year: 1905, location: "metula"
- line_start: 8, line_end: 10, year: 1906, location: "metula"
```

---

## שלב 3: שמירת התוצאה

שמור את התוצאה מ-AI כ:
`movie/output/scripts/pages_tagged_by_ai.json`

**חשוב:** שמור את אותו מבנה JSON, רק עם השדה החדש `line_tags` שהוספת לכל עמוד.

**מבנה צפוי:**
```json
{
  "metadata": {...},
  "pages": [
    {
      "id": "beit_markovski_page_014",
      "book_id": "beit_markovski",
      "book_name": "בית מרקובסקי",
      "page_number": 14,
      "chapter": "באר־טוביה",
      "full_text": "...",
      "lines": [...],
      "line_tags": [
        {
          "line_start": 1,
          "line_end": 5,
          "year": 1904,
          "month": null,
          "location": "beer_tuvia",
          "locations": ["beer_tuvia", "jaffa"],
          "characters": ["yehuda"],
          "confidence": "high"
        },
        ...
      ]
    },
    ...
  ]
}
```

---

## שלב 4: MERGE לפי התיוגים

```bash
python 03_merge_books_with_ai_tags.py
```

זה יוצר את הקובץ: `merged_books_with_ai_tags.txt`

**מה הסקריפט עושה:**
- קורא את התיוגים מ-AI (טווחי שורות)
- מחלץ את הטקסט לפי טווחי השורות המתויגים
- מסדר לפי: שנה → חודש → מיקום
- יוצר טקסט ממוזג עם ציון מקור לכל חלק (עמוד + שורות)

---

## 💡 טיפים:

### אם AI שואל שאלות:
- **"מה זה מטולה?"** → מושבה בצפון הארץ, 1900-1921
- **"מה זה באר טוביה?"** → מושבה בדרום, נקראה גם קוסטינה/קסטינה
- **"מי הדמויות?"** → יוסף, מורייה, יהודה, רוחמה, עמנואל, תרצה, ואזרח

### אם יש בעיות:
- אם AI לא מזהה תאריך, זה בסדר - תן null
- אם AI לא בטוח במיקום, תן null
- עדיף null מאשר ניחוש לא מדויק

### איכות התיוג:
- **high confidence** = יש תאריך/מיקום מפורש בטקסט
- **medium confidence** = ניתן להעריך מהקשר (פרק, אירועים)
- **low confidence** = לא בטוח, אבל ניסיתי

### טווחי שורות:
- **טווחים יכולים לחפוף?** לא, כל שורה צריכה להיות בטווח אחד בלבד
- **מה אם שורה ריקה?** אפשר לדלג עליה או לכלול אותה בטווח הקרוב
- **מה אם כל העמוד באותו הקשר?** תייג טווח אחד שמכסה את כל השורות

---

## 📝 דוגמה מלאה:

### לפני (מהתבנית):
```json
{
  "id": "beit_markovski_page_014",
  "book_id": "beit_markovski",
  "book_name": "בית מרקובסקי",
  "page_number": 14,
  "chapter": "באר־טוביה",
  "full_text": "יהודה מור עלה ארצה כילד ב-1904...",
  "lines": [
    {"line_number": 1, "text": "יהודה מור עלה ארצה כילד ב-1904", "is_empty": false},
    {"line_number": 2, "text": "השנה בה החלה העלייה השנייה", "is_empty": false},
    {"line_number": 3, "text": "הוא הגיע ליפו בחודש ניסן", "is_empty": false},
    {"line_number": 4, "text": "ומשם המשיך לבאר טוביה", "is_empty": false},
    {"line_number": 5, "text": "", "is_empty": true},
    {"line_number": 6, "text": "בבאר טוביה הוא פגש את יוסף", "is_empty": false}
  ]
}
```

### אחרי (מתויג על ידי AI):
```json
{
  "id": "beit_markovski_page_014",
  "book_id": "beit_markovski",
  "book_name": "בית מרקובסקי",
  "page_number": 14,
  "chapter": "באר־טוביה",
  "full_text": "יהודה מור עלה ארצה כילד ב-1904...",
  "lines": [...],
  "line_tags": [
    {
      "line_start": 1,
      "line_end": 4,
      "year": 1904,
      "month": "ניסן",
      "location": "jaffa",
      "locations": ["jaffa", "beer_tuvia"],
      "characters": ["yehuda"],
      "confidence": "high"
    },
    {
      "line_start": 6,
      "line_end": 6,
      "year": 1904,
      "month": null,
      "location": "beer_tuvia",
      "locations": ["beer_tuvia"],
      "characters": ["yehuda", "yosef"],
      "confidence": "high"
    }
  ]
}
```

---

## ✅ בדיקה:

לפני שאתה ממשיך ל-MERGE, בדוק:
- [ ] כל עמוד יש לו `line_tags` (רשימה)
- [ ] כל טווח יש לו `line_start` ו-`line_end` תקינים
- [ ] כל טווח יש לו `year` (או null אם לא ניתן לזהות)
- [ ] כל טווח יש לו `location` (או null)
- [ ] כל טווח יש לו `confidence`
- [ ] כל השורות הלא-ריקות מכוסות (או לפחות רוב השורות)
- [ ] אין טווחים חופפים (אותו שורה בשני טווחים)
- [ ] המבנה JSON תקין (פתיחה וסגירה של סוגריים)

אם הכל תקין, המשך ל-MERGE! 🎯
