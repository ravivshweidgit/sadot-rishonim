# סדר עבודה - יצירת סרט AI על מטולה 1900-1921

## הגישה: AI מתייג → AI קובע insertion points → Python ממזג

**הגישה הנבחרת:** 
1. AI מתייג טווחי שורות בתוך עמודים (שנה, חודש, מיקום)
2. AI קובע insertion points: לכל קטע מהספר של רוחמה, AI קובע איפה הוא צריך להיכנס בספר של יהודה
3. Python ממזג לפי insertion points (שומר על הסדר המקורי של הספר של יהודה)

**למה insertion points?**
- ✅ הספר של יהודה נשאר בסדר המקורי שלו (מסגרת הנרטיב נשמרת)
- ✅ AI מבין את ההקשר הכרונולוגי והנרטיבי בין שני הספרים
- ✅ קטעים מהספר של רוחמה נכנסים בנקודות המתאימות לפי הקשר, לא רק לפי זמן
- ✅ Python עובד עם מבנה שהוא מבין (עמודים ושורות ממוספרות)
- ✅ שמירה על הקשר מדויק - כל קטע יודע מאיזה עמוד ואילו שורות

---

## שלב 1: יצירת תבנית לתיוג (Python)

### 1.1 הרצת סקריפט יצירת תבנית

**מטרה:** יצירת קובץ JSON עם כל העמודים מוכן לתיוג

**פעולות:**
```bash
cd movie/scripts
python 01_tag_pages_with_ai.py
```

**פלט:**
- `movie/output/scripts/pages_for_ai_tagging.json` - קובץ עם כל העמודים

**מה הסקריפט עושה:**
1. קורא את כל קבצי הטקסט מהספרים (~276 עמודים)
2. מנקה את הטקסט (מסיר headers, page numbers)
3. יוצר מבנה JSON עם כל העמודים
4. כל עמוד כולל: טקסט מלא, שורות ממוספרות, פרק, עמוד, book_id
5. מוכן לתיוג טווחי שורות על ידי AI

**תוצאה צפויה:**
- קובץ JSON עם ~276 עמודים
- כל עמוד מוכן לתיוג על ידי AI

---

## שלב 2: תיוג עם AI

### 2.1 תיוג אוטומטי עם Gemini API

**מטרה:** AI מתייג כל עמוד עם שנה, חודש, מיקום, דמויות

**פעולות:**
```bash
cd movie/scripts
python 02_tag_pages_with_gemini.py
```

**מה הסקריפט עושה:**
1. קורא את `pages_for_ai_tagging.json`
2. שולח כל עמוד ל-Gemini API לתיוג
3. AI מתייג טווחי שורות בתוך כל עמוד עם:
   - `line_start`, `line_end`: טווח השורות
   - `year`: השנה (1900-1921)
   - `month`: החודש (אם ניתן לזהות)
   - `location`: המיקום הגיאוגרפי הראשי
   - `locations`: כל המיקומים המוזכרים
   - `characters`: הדמויות המוזכרות
   - `confidence`: רמת ביטחון (high/medium/low)

4. משתמש בהבנת הקשר כדי לזהות תאריכים ומיקומים גם אם הם לא מפורשים
5. יוצר רשימת `line_tags` לכל עמוד

**תוצאה צפויה:**
- `movie/output/scripts/pages_tagged_by_ai.json` - קובץ JSON עם כל העמודים מתויגים

**אלטרנטיבה (ידנית):**
אם אתה רוצה לעשות את זה ידנית עם ChatGPT/Claude:
1. פתח את `movie/output/scripts/pages_for_ai_tagging.json`
2. שלח ל-ChatGPT/Claude עם ההוראות המפורטות
3. **👉 קרא את ההוראות המפורטות:** [AI_TAGGING_INSTRUCTIONS.md](AI_TAGGING_INSTRUCTIONS.md)
4. שמור את התוצאה כ-`pages_tagged_by_ai.json`

---

### 2.2 קביעת insertion points עם AI (חלוקה לפסקאות)

**מטרה:** AI מחלק את הספר של רוחמה לפסקאות בעלות הקשר וקובע לכל פסקה איפה היא צריכה להיכנס בספר של יהודה

**פעולות:**
```bash
cd movie/scripts
python 02b_determine_insertion_points.py
```

**מה הסקריפט עושה:**
1. קורא את `pages_tagged_by_ai.json` (התיוגים משלב 2.1)
2. AI קורא את הספר של יהודה במלואו כדי להבין את ההקשר הכרונולוגי והנרטיבי
3. **לכל עמוד מהספר של רוחמה:**
   - AI מחלק את העמוד לפסקאות בעלות הקשר (contextually coherent paragraphs)
   - כל פסקה יכולה להיות שורה אחת, כמה שורות, או חלק מעמוד
   - לכל פסקה, AI קובע:
     - `source_line_start`, `source_line_end`: טווח השורות של הפסקה בספר של רוחמה
     - `insert_after_page`: מספר עמוד בספר של יהודה אחרי איזה להכניס
     - `insert_after_line`: מספר שורה בספר של יהודה אחרי איזה להכניס (0 = אחרי כל העמוד)
     - `insert_reason`: סיבה קצרה למה כאן (לפי הקשר כרונולוגי/נרטיבי)
     - `confidence`: רמת ביטחון (high/medium/low)

**למה פסקאות ולא עמודים שלמים?**
- ✅ פסקאות שומרות על הקשר מדויק יותר
- ✅ כל פסקה יכולה להיכנס בנקודה המתאימה לה בספר של יהודה
- ✅ שמירה על רצף פסקתי בספר של רוחמה
- ✅ שילוב חלק יותר בספר של יהודה

**דוגמה:**
- אם עמוד 5 בספר של רוחמה מתאר הגעה ליפו ב-1904 ואז מעבר לבאר טוביה
- ועמוד 9 בספר של יהודה מתאר ילדות ברוסיה (לפני 1904)
- AI יחלק את עמוד 5 לפסקאות:
  - פסקה 1 (שורות 1-5): הגעה ליפו → תכנס אחרי עמוד 9 בספר של יהודה
  - פסקה 2 (שורות 6-10): מעבר לבאר טוביה → תכנס בנקודה מתאימה אחרת

**תוצאה צפויה:**
- `movie/output/scripts/insertion_points.json` - קובץ JSON עם כל ה-insertion points ברמת פסקאות

---

## שלב 3: מיזוג לפי insertion points (Python)

### 3.1 הרצת סקריפט מיזוג

**מטרה:** מיזוג שני הספרים לפי insertion points שקבע AI

**פעולות:**
```bash
python 03_merge_books_with_ai_tags.py
```

**פלט:**
- `movie/output/scripts/merged_books_with_ai_tags.txt` - הטקסט הממוזג
- `movie/output/scripts/merged_books_with_ai_tags_structure.json` - המבנה

**מה הסקריפט עושה:**
1. קורא את התיוגים מ-AI (`pages_tagged_by_ai.json`)
2. קורא את ה-insertion points (`insertion_points.json`) - ברמת פסקאות
3. שומר על הסדר המקורי של הספר של יהודה (שדות ראשונים)
4. מכניס פסקאות מהספר של רוחמה בנקודות שקבע AI (לפי `insert_after_page` ו-`insert_after_line`)
5. יוצר טקסט ממוזג עם ציון מקור לכל חלק (עמוד + שורות)
6. שומר גם מבנה JSON למעקב

**תוצאה צפויה:**
- טקסט ממוזג עם הסדר המקורי של הספר של יהודה
- פסקאות מהספר של רוחמה נכנסות בנקודות המתאימות לפי הקשר
- כל חלק כולל ציון מקור: `[מבית מרקובסקי - מטולה, עמוד 27, שורות 5-10 | הסיבה: מתאר אירוע שקרה לפני עמוד 9 בספר של יהודה]`
- זה התסריט שלך!

**הערה:** אם אין `insertion_points.json`, הסקריפט ישתמש במיון כרונולוגי (שיטה ישנה) כגיבוי.

---

## שלב 4: תיוג מפורט + בניית סצנות (עתידי) 🎯

**מטרה:** אחרי שיש לנו את הטקסט הממוזג הכרונולוגי, נבנה סצנות מפורטות.

**מתי?** אחרי ששלב 3 הושלם ויש לנו `merged_books_with_ai_tags.txt`

**למה לחכות?**
- ✅ AI רואה את כל הסיפור לפי סדר הזמן
- ✅ יכול לבנות סצנות הגיוניות יותר
- ✅ תיוג דמויות מדויק יותר (רואה התפתחות לאורך זמן)

**מה נעשה:**
1. **תיוג מפורט:** AI יתייג את הטקסט הממוזג עם מידע מפורט על דמויות, מיקומים, אירועים
2. **בניית סצנות:** AI יקבץ קטעים קשורים לסצנות, כל סצנה עם תיאור ויזואלי וטקסט קריינות

**👉 ראה:** [SCENE_GENERATION_PLAN.md](SCENE_GENERATION_PLAN.md) - תכנית מפורטת לבניית סצנות

**תוצאה צפויה:**
- `scenes.json` - רשימת סצנות מוכנות ליצירת וידאו
- כל סצנה כוללת: טקסט קריינות, תיאור ויזואלי, דרישות ויזואליות

---

## שלב 5: יצירת קריינות (AI)

### 4.1 יצירת קריינות מהטקסט הממוזג

**מטרה:** המרת הטקסט הממוזג לקריינות (Text-to-Speech)

**פעולות:**
1. פתח את `merged_books_with_ai_tags.txt`
2. השתמש ב-AI או ב-TTS engine ליצירת קריינות

**אפשרויות:**
- **gTTS (Google Text-to-Speech)** - חינמי, פשוט
- **Google Cloud TTS** - איכות טובה, בתשלום
- **ElevenLabs** - איכות מעולה, בתשלום
- **AI (ChatGPT/Claude)** - יכול לעבד את הטקסט לפני TTS

**תוצאה צפויה:**
- קבצי אודיו MP3 לכל חלק/סצנה
- קריינות סינכרונית עם הטקסט

---

## שלב 5: יצירת וידאו (AI + Python)

### 5.1 יצירת וידאו לכל סצנה

**מטרה:** יצירת קטעי וידאו המסונכרנים עם הקריינות

**פעולות:**
1. קח את הטקסט הממוזג והקריינות
2. השתמש ב-AI Video Generation (Runway, Pika, Stable Video) ליצירת וידאו
3. כל קטע וידאו צריך להיות באורך זהה לקריינות שלו

**תוצאה צפויה:**
- קטעי וידאו MP4 לכל חלק/סצנה
- כל קטע מסונכרן עם הקריינות שלו

---

## שלב 6: חיבור הסרט (Python)

### 6.1 חיבור כל הקטעים לסרט אחד

**מטרה:** חיבור כל קטעי הוידאו והקריינות לסרט אחד שלם

**פעולות:**
```bash
python combine_scenes.py  # (עדיין לא נוצר)
```

**מה הסקריפט יעשה:**
1. יקח את כל קטעי הוידאו
2. יקח את כל קבצי הקריינות
3. יחבר את הכל לסרט אחד
4. יוסיף מעברים בין סצנות

**תוצאה צפויה:**
- `movie/output/final/movie_metula_1900_1921.mp4` - הסרט הסופי

---

## 📋 סיכום התהליך

```
שלב 1-4: תיוג בסיסי + קביעת insertion points + MERGE (עכשיו)
1. Python → יוצר תבנית לתיוג
2a. AI → מתייג טווחי שורות (שנה, חודש, מיקום, דמויות מוזכרות)
2b. AI → מחלק את הספר של רוחמה לפסקאות וקובע insertion points (לכל פסקה, איפה להיכנס בספר של יהודה)
3. Python → ממזג לפי insertion points (שומר על הסדר המקורי של הספר של יהודה) → merged_books_with_ai_tags.txt ✅

שלב 4: תיוג מפורט + בניית סצנות (אחרי MERGE)
4. AI → מתייג מפורט + בונה סצנות → scenes.json 🎯

שלב 5-6: יצירת הסרט (עתידי)
5. AI → יוצר קריינות
6. AI → יוצר וידאו
7. Python → מחבר הכל לסרט אחד
```

---

## 💡 הערות חשובות

- **שלבים 1-4 הם הבסיס** - זה יוצר את התסריט הממוזג עם הסדר המקורי של הספר של יהודה ופסקאות מהספר של רוחמה בנקודות המתאימות ✅
- **שלב 4 (תיוג מפורט + סצנות) צריך לחכות** - אחרי שיש לנו את הטקסט הממוזג 🎯
- **שלבים 5-6 הם מתקדמים** - יצירת הסרט עצמו (עתידי)
- **עבוד שלב אחר שלב** - אין צורך למהר
- **בדוק תוצאות** - ודא שכל שלב עובד לפני שאתה ממשיך

---

## 📚 קריאה נוספת

- [GETTING_STARTED.md](GETTING_STARTED.md) - התחלה מהירה
- [AI_TAGGING_INSTRUCTIONS.md](AI_TAGGING_INSTRUCTIONS.md) - הוראות מפורטות לתיוג
- [SCENE_GENERATION_PLAN.md](SCENE_GENERATION_PLAN.md) - תכנית בניית סצנות
