# שיפורי איכות OCR

סקריפטים משופרים לשיפור איכות ה-OCR של טקסטים עבריים היסטוריים.

## סקריפטים חדשים

### 1. `ocr_pdfs_improved.py` - OCR משופר

סקריפט OCR משופר עם מספר שיפורים:

#### שיפורים עיקריים:

1. **Prompt משופר עם הקשר**
   - הוספת הקשר על הטקסט העברי והתקופה ההיסטורית
   - רשימת מילים נפוצות מהטקסט
   - אזהרות על שגיאות OCR נפוצות

2. **עיבוד תמונה מראש (Preprocessing)**
   - הגדלת ניגודיות (contrast)
   - חדות תמונה (sharpening)
   - שיפור בהירות (brightness)
   - המרה ל-RGB אם נדרש

3. **עיבוד לאחר OCR (Post-processing)**
   - תיקון שגיאות נפוצות אוטומטית
   - תיקון רווחים בין מילים
   - נורמליזציה של רווחים מרובים

4. **רזולוציה גבוהה יותר**
   - הגדלה מ-3x ל-4x לאיכות תמונה טובה יותר

5. **שימוש במודל טוב יותר**
   - ניסיון להשתמש ב-Gemini Pro במקום Flash לאיכות טובה יותר

#### שימוש:

```bash
# עיבוד קובץ ספציפי (מהיר - ברירת מחדל)
python ocr_pdfs_improved.py 067

# עיבוד עם ספר ספציפי
python ocr_pdfs_improved.py --book beit_markovski 067

# מצב מהיר (מבלי חדות תמונה - חוסך זמן)
python ocr_pdfs_improved.py --fast 067

# ללא עיבוד תמונה מראש (הכי מהיר)
python ocr_pdfs_improved.py --no-preprocess 067

# ללא עיבוד טקסט לאחר OCR
python ocr_pdfs_improved.py --no-postprocess 067

# עיבוד מחדש של קבצים קיימים
python ocr_pdfs_improved.py --force 067

# שימוש במודל Pro לאיכות גבוהה יותר (איטי יותר)
python ocr_pdfs_improved.py --use-pro 067

# שליחת תמונה גולמית ללא עיבוד מקדים (מהיר ביותר)
python ocr_pdfs_improved.py --raw 067

# ניסיון לשלוח PDF ישירות (ניסיוני - לא נתמך במלואו)
python ocr_pdfs_improved.py --pdf-direct 067
```

#### אופטימיזציות למהירות:

הסקריפט כולל מספר אופטימיזציות למהירות:
- **רזולוציה 3.5x** במקום 4x (מאזן בין איכות למהירות)
- **מודל Flash** כברירת מחדל (מהיר יותר מ-Pro)
- **מצב מהיר** (`--fast`) - מדלג על חדות תמונה
- **דילוג על preprocessing** (`--no-preprocess`) - הכי מהיר

### 2. `analyze_ocr_errors.py` - ניתוח שגיאות OCR

סקריפט לזיהוי שגיאות OCR נפוצות ולבניית מילון תיקונים.

#### תכונות:

- סריקת כל קבצי הטקסט לאיתור שגיאות נפוצות
- בניית מילון תיקונים אוטומטי
- דוח על תדירות השגיאות
- הצעות לשיפור ה-prompt

#### שימוש:

```bash
# ניתוח שגיאות בספר ברירת המחדל
python analyze_ocr_errors.py

# ניתוח שגיאות בספר ספציפי
python analyze_ocr_errors.py --book beit_markovski
```

## שגיאות OCR נפוצות שזוהו

השגיאות הבאות כבר נוספו למילון התיקונים:

- `מנוייסים` → `מגויסים`
- `כמותות` → `כמויות`
- `סנדוריות` → `סנדלריות`
- `מעמונות` → `מעבורות`
- `ציטטו` → `צפו`
- `שחיתוה` → `שחשכו`
- `עגונות` → `עננים`
- `ניצני הארבה` → `ביצי הארבה`
- `הנדם` → `הנמט`
- `נחולה` → `נחילה`
- `מפיד` → `פוגש`
- `סוסיה` → `סוסים`
- `יריה` → `ירייה`
- `צדון` → `צידון`

## המלצות לשיפור נוסף

### 1. עדכון ה-prompt בהתאם לשגיאות חדשות

כשאתה מוצא שגיאות חדשות:
1. הרץ `analyze_ocr_errors.py` לזיהוי דפוסים
2. עדכן את `COMMON_CORRECTIONS` ב-`ocr_pdfs_improved.py`
3. עדכן את ה-prompt עם אזהרות על השגיאות החדשות

### 2. שימוש ב-context מהעמודים הקודמים

לשיפור נוסף, אפשר להוסיף:
- הקשר מהעמוד הקודם ל-prompt
- זיהוי שמות מקומות ושמות אנשים מהטקסט שכבר עובד

### 3. שילוב עם OCR נוסף

אפשר לשלב:
- Tesseract OCR כגיבוי
- השוואה בין תוצאות מכמה מנועי OCR
- בחירת התוצאה הטובה ביותר

### 4. למידה מהתיקונים שלך

כשאתה מתקן שגיאות ידנית:
1. שמור את התיקונים ב-`fix_ocr_errors.py`
2. הרץ `analyze_ocr_errors.py` כדי לזהות דפוסים
3. עדכן את `COMMON_CORRECTIONS` אוטומטית

## השוואה בין הסקריפטים

| תכונה | ocr_pdfs.py | ocr_pdfs_improved.py |
|------|-------------|---------------------|
| רזולוציה | 3x | 4x |
| Preprocessing | לא | כן |
| Post-processing | לא | כן |
| Prompt משופר | בסיסי | מתקדם עם הקשר |
| מודל | Flash | Pro (אם זמין) |
| מילון תיקונים | לא | כן |

## טיפים לשימוש

1. **לעמודים קשים במיוחד**: השתמש ב-`ocr_pdfs_improved.py` עם כל השיפורים
2. **לעמודים פשוטים**: אפשר להשתמש ב-`ocr_pdfs.py` המקורי (מהיר יותר)
3. **לזיהוי שגיאות**: הרץ `analyze_ocr_errors.py` לפני עיבוד מחדש
4. **לתיקון ידני**: שמור את התיקונים ב-`fix_ocr_errors.py` לשימוש עתידי

## הערות

- הסקריפט המשופר איטי יותר בגלל עיבוד התמונה והטקסט
- מומלץ להשתמש בו לעמודים בעייתיים או לעיבוד מחדש
- הסקריפט המקורי עדיין זמין לשימוש מהיר
